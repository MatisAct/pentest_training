#[Task 23] PHP cơ bản
###các công việc cần làm
- [**Kết nối database**](#1)
- [**Trang đăng nhập/đăng kí có kết nối database**](#2)
- [**Chức năng tìm kiếm**](#3)
- [**Chức năng download/upload file**](#3)
- [**Chức năng cho người khác comment vào bài blog**](#4)

<a name="1"></a>
####1:Kết nối database(hostinger)

<img src="http://image.prntscr.com/image/6253f6e353194796a4d91bce219282ff.png">

**php kết nối**
```
<?php
$db_host = "localhost"; // Giữ mặc định là localhost
$db_name    = 'ten tao o tren';
$db_username    = 'ten tao o tren';
$db_password    = '*********';
@mysql_connect("{$db_host}", "{$db_username}", "{$db_password}") or die("Không thể kết nối database");
@mysql_select_db("{$db_name}") or die("Không thể chọn database");
?>
?>
```
<a name="2"></a>
####2:Trang đăng nhập/đăng kí có kết nối database

- trước hết phải tạo table để lưu thông tin

<img src="http://image.prntscr.com/image/455120293cb941fb9a7e71c51c8b4893.png">

<img src="http://image.prntscr.com/image/6b4115eddeed4604b2546084fb8f6c8f.png">


tiếp theo vào insert tabble để thêm thông tin:nhấn go để thêm

<img src="http://image.prntscr.com/image/7d30bc39d20d4960a49544f6e17434a5.png">


**code PHP đăng kí và form đăng kí**

```
<?php
// Tải file mysql.php lên
require_once("mysql.php");
//Kiem tra email co hop le hay ko
function check_email($email) {
    if (strlen($email) == 0) return false;
    if (eregi("^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$", $email)) return true;
    return false;
}
if ( $_GET['act'] == "do" )
{
    // Dùng hàm addslashes() để tránh SQL injection, dùng hàm md5() để mã hóa password
    $username = addslashes( $_POST['username'] );
    $password = md5( addslashes( $_POST['password'] ) );
    $verify_password = md5( addslashes( $_POST['verify_password'] ) );
    $email = addslashes( $_POST['email'] );
    $ten = addslashes( $_POST['name'] );
    $sinhnhat = addslashes( $_POST['sn'] );
    $url = addslashes( $_POST['url'] );
    // Kiểm tra 7 thông tin, nếu có bất kỳ thông tin chưa điền thì sẽ báo lỗi
    if ( ! $username || ! $_POST['password'] || ! $_POST['verify_password'] || ! $email || ! $ten || ! $sinhnhat || ! $ten)
    {
        print "Xin vui lòng nhập đầy đủ các thông tin. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Kiểm tra username nay co nguoi dung chua
    if ( mysql_num_rows(mysql_query("SELECT username FROM members WHERE username='$username'"))>0)
    {
        print "Username này đã có người dùng, Bạn vui lòng chọn username khác. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Kiểm tra email nay co hop le ko
    if (!check_email($email))
    {
        print "Email này ko hợp lệ. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    if (!ereg("^[0-9]+/[0-9]+/[0-9]{2,4}",$sinhnhat))
    {
        print "Ngày tháng năm sinh ko hợp lệ. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Kiểm tra email nay co nguoi dung chua
    if ( mysql_num_rows(mysql_query("SELECT email FROM members WHERE email='$email'"))>0)
    {
        print "Email này đã có người dùng, Bạn vui lòng chọn Email khác. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Kiểm tra mật khẩu, bắt buộc mật khẩu nhập lúc đầu và mật khẩu lúc sau phải trùng nhau
    if ( $password != $verify_password )
    {
        print "Mật khẩu không giống nhau, bạn hãy nhập lại mật khẩu. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Tiến hành tạo tài khoản
    @$a=mysql_query("INSERT INTO members (username, password, email,URLS,Name,Birthday) VALUES ('{$username}', '{$password}', '{$email}', '{$url}', '{$ten}', '{$sinhnhat}')");
    // Thông báo hoàn tất việc tạo tài khoản
    if ($a)
        print "Tài khoản {$username} đã được tạo. <a href='login.php'>Nhấp vào đây để đăng nhập</a>";
    else
        print "Có lỗi trong quá trình đăng kí, Vui lòng liên hệ BQT";
}
else
{
// Form đăng ký
print <<<EOF
<form action="register.php?act=do" method="post">
    <table border="1" width="400" cellspacing="1" style="border-collapse: collapse" bordercolor="#C0C0C0">
        <tr>
            <td>Tên truy nhập:</td>
            <td><input type="text" name="username" value=""></td>
        </tr>
        <tr>
            <td>Mật khẩu:</td>
            <td><input type="password" name="password" value=""></td>
        </tr>
        <tr>
            <td>Xác nhận mật khẩu:</td>
            <td><input type="password" name="verify_password" value=""></td>
        </tr>
        <tr>
            <td>Địa chỉ E-mail:</td>
            <td><input type="text" name="email" value=""></td>
        </tr>
        <tr>
            <td>URL:</td>
            <td><input type="text" name="url" value=""></td>
        </tr>
        <tr>
            <td>Tên:</td>
            <td><input type="text" name="name" value=""></td>
        </tr>
        <tr>
            <td>Sinh nhật  (Ngày/Tháng/Năm):</td>
            <td><input type="text" name="sn" value=""></td>
        </tr>
        <tr>
            <td><input type="submit" name="submit" value="Đăng ký tài khoản"></td>
            <td><Font size="5"> SinhViênIT.Net</Font></td>
        </tr>
    </table>
</form>
EOF;
}
?>
```

**tạo trang đăng nhập**

```
<?php
session_start();
header('Content-Type: text/html; charset=UTF-8');
echo '<title>matisact.tk- dang nhap (Huong Dan tao trang dang ki/Dang Nhap)</title>';
// Tải file mysql.php lên
require_once("mysql.php");
if ( $_GET['act'] == "do" )
{
    // Dùng hàm addslashes() để tránh SQL injection, dùng hàm md5() để mã hóa password
    $username = addslashes( $_POST['username'] );
    $password = md5( addslashes( $_POST['password'] ) );
    // Lấy thông tin của username đã nhập trong table members
    $sql_query = @mysql_query("SELECT id, username, password FROM members WHERE username='{$username}'");
    $member = @mysql_fetch_array( $sql_query );
    // Nếu username này không tồn tại thì....
    if ( @mysql_num_rows( $sql_query ) <= 0 )
    {
        print "Tên truy nhập không tồn tại. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Nếu username này tồn tại thì tiếp tục kiểm tra mật khẩu
    if ( $password != $member['password'] )
    {
        print "Nhập sai mật khẩu. <a href='javascript:history.go(-1)'>Nhấp vào đây để quay trở lại</a>";
        exit;
    }
    // Khởi động phiên làm việc (session)
    $_SESSION['user_id'] = $member['id'];
    $_SESSION['user_admin'] = $member['admin'];
    // Thông báo đăng nhập thành công
    print "Bạn đã đăng nhập với tài khoản {$member['username']} thành công. <a href='index.php'>Nhấp vào đây để vào trang chủ</a>";
}
else
{
// Form đăng nhập
print <<<EOF
<form action="login.php?act=do" method="post">
Tên truy nhập: <input type="text" name="username" value="">
Mật khẩu: <input type="password" name="password" value="">
<input type="submit" name="submit" value="Đăng nhập">
</form>
EOF;
}
?>
```
