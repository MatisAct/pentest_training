#[Task 23] PHP cơ bản
###các công việc cần làm
- [**Kết nối database**](#1)
- [**Trang đăng nhập/đăng kí có kết nối database**](#2)
- [**Chức năng tìm kiếm**](#3)
- [**Chức năng download/upload file**](#3)
- [**Chức năng cho người khác comment vào bài blog**](#4)

<a name="1"></a>
####1:Kết nối database(hostinger)

<img src="http://image.prntscr.com/image/6253f6e353194796a4d91bce219282ff.png">

**php kết nối tên SQL.php**
```
<?php
$db_host = "địa chỉ hosting cung cấp"; // Giữ mặc định là localhost đối với xampp
$db_name    = 'ten tao o tren';
$db_username    = 'ten tao o tren';
$db_password    = '*********';
@mysql_connect("{$db_host}", "{$db_username}", "{$db_password}") or die("Không thể kết nối database");
@mysql_select_db("{$db_name}") or die("Không thể chọn database");
?>
?>
```
<a name="2"></a>
####2:Trang đăng nhập/đăng kí có kết nối database

- trước hết phải tạo table để lưu thông tin

<img src="http://image.prntscr.com/image/455120293cb941fb9a7e71c51c8b4893.png">

<img src="http://image.prntscr.com/image/6b4115eddeed4604b2546084fb8f6c8f.png">


tiếp theo vào insert tabble để thêm thông tin:nhấn go để thêm

<img src="http://image.prntscr.com/image/7d30bc39d20d4960a49544f6e17434a5.png">


**code PHP đăng kí và form đăng kí**
- Tạo kết nối đến mysql để lấy dữ liệu
```
<?php
$server_username = "tên ";
$server_password = "********";
$server_host = "url";
$database = 'tên database';
 
$conn = mysqli_connect($server_host,$server_username,$server_password,$database) or die("không thể kết nối tới database");
mysqli_query($conn,"SET NAMES 'UTF8'");
```
form đăng kí tên register.php
```
<html>
	<head>
		<title>matisact - Form đăng ký thành viên</title>
	</head>
	<body>
		<?php
		require_once("url kết nối");
		if (isset($_POST["btn_submit"])) {
  			//lấy thông tin từ các form bằng phương thức POST
  			$username = $_POST["username"];
  			$password = $_POST["pass"];
 			 $name = $_POST["name"];
  			$email = $_POST["email"];
  			//Kiểm tra điều kiện bắt buộc đối với các field không được bỏ trống
			  if ($username == "" || $password == "" || $name == "" || $email == "") {
				   echo "bạn vui lòng nhập đầy đủ thông tin";
  			}else{
				    //thực hiện việc lưu trữ dữ liệu vào db
    				$sql = "INSERT INTO users(
    					username,
    					password,
    					name,
					    email
    					) VALUES (
    					'$username',
    					'$password',
					    '$name',
    					'$email'
    					)";
				    // thực thi câu $sql với biến conn lấy từ file connection.php
   				mysqli_query($conn,$sql);
				   echo "chúc mừng bạn đã đăng ký thành công";
			  }
	}
	?>
	<form action="register.php" method="post">
		<table>
			<tr>
				<td colspan="2">Form dang ky</td>
			</tr>	
			<tr>
				<td>Username :</td>
				<td><input type="text" id="username" name="username"></td>
			</tr>
			<tr>
				<td>Password :</td>
				<td><input type="password" id="pass" name="pass"></td>
			</tr>
			<tr>
				<td>Ho Ten :</td>
				<td><input type="text" id="name" name="name"></td>
			</tr>
			<tr>
				<td>Email :</td>
				<td><input type="text" id="email" name="email"></td>
			</tr>
			<tr>
				<td colspan="2" align="center"><input type="submit" name="btn_submit" value="Dang ky"></td>
			</tr>
 
		</table>
 
	</form>
	</body>
	</html>
```


- form đăng nhập tên login.php

```
<table width="300" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#CCCCCC">
<tr>
<form name="form1" method="post" action="checklogin.php">
<td>
<table width="100%" border="0" cellpadding="3" cellspacing="1" bgcolor="#FFFFFF">
<tr>
<td colspan="3"><strong>Member Login </strong></td>
</tr>
<tr>
<td width="78">Username</td>
<td width="6">:</td>
<td width="294"><input name="myusername" type="text" id="myusername"></td>
</tr>
<tr>
<td>Password</td>
<td>:</td>
<td><input name="mypassword" type="text" id="mypassword"></td>
</tr>
<tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td><input type="submit" name="Submit" value="Login"></td>
</tr>
</table>
</td>
</form>
</tr>
</table>
```

- Xử lý thông tin đăng nhập:checklogin.php

```
<?php
session_start();
?>
<html>
<head>
	<title>Trang đăng nhập</title>
	<meta charset="utf-8">
</head>
<body>
<?php
	//Gọi file connection.php
	require_once("https:yyy/connection.php");
	// Kiểm tra nếu người dùng đã ân nút đăng nhập thì mới xử lý
	if (isset($_POST["btn_submit"])) {
		// lấy thông tin người dùng
		$username = $_POST["username"];
		$password = $_POST["password"];
		//làm sạch thông tin, xóa bỏ các tag html, ký tự đặc biệt 
		//mà người dùng cố tình thêm vào để tấn công theo phương thức sql injection
		$username = strip_tags($username);
		$username = addslashes($username);
		$password = strip_tags($password);
		$password = addslashes($password);
		if ($username == "" || $password =="") {
			echo "username hoặc password bạn không được để trống!";
		}else{
			$sql = "select * from users where username = '$username' and password = '$password' ";
			$query = mysqli_query($conn,$sql);
			$num_rows = mysqli_num_rows($query);
			if ($num_rows==0) {
				echo "tên đăng nhập hoặc mật khẩu không đúng !";
			}else{
				//tiến hành lưu tên đăng nhập vào session để tiện xử lý sau này
				$_SESSION['username'] = $username;
                // Thực thi hành động sau khi lưu thông tin vào session
                //  tiến hành chuyển hướng trang web tới một trang gọi là index.php
                header('url index.php');
			}
		}
	}
?>
	<form method="POST" action="login.php">
	<fieldset>
	    <legend>Đăng nhập</legend>
	    	<table>
	    		<tr>
	    			<td>Username</td>
	    			<td><input type="text" name="username" size="30"></td>
	    		</tr>
	    		<tr>
	    			<td>Password</td>
	    			<td><input type="password" name="password" size="30"></td>
	    		</tr>
	    		<tr>
	    			<td colspan="2" align="center"> <input name="btn_submit" type="submit" value="Đăng nhập"></td>
	    		</tr>
	    	</table>
  </fieldset>
  </form>
</body>
</html>
```
<a name="3"></a>
####chức năng tìm kiếm 
- đầu tiên tạo database mang bên `basic` với 1 bảng tên là `user` 	

<img src="http://image.prntscr.com/image/c19ed7a58e8b4a6b8d88c49765a317fe.png">

- tạo code php tìm kiếm với like, lưu dưới tên `like.php` 

```
<html>
    <head>
        <title>Demo Search </title>
    </head>
    <body>
        <div align="center">
            <form method="get">
                Search: <input type="text" name="search" />
                <input type="submit" name="ok" value="search" />
            </form>
            <?php
$conn=mysql_connect("localhost","root","") or die("error");// kết nối database
mysql_select_db("basic",$conn);
?>
        </div>
        <?php
        // Nếu người dùng submit form thì thực hiện
        if (isset($_REQUEST['ok'])) 
        {
            // Gán hàm addslashes để chống sql injection
            $search = addslashes($_GET['search']);
 
            // Nếu $search rỗng thì báo lỗi, tức là người dùng chưa nhập liệu mà đã nhấn submit.
            if (empty($search)) {
                echo "nhập dữ liệu pls";
            } 
            else
            {
                // Dùng câu lênh like trong sql và sứ dụng toán tử % của php để tìm kiếm dữ liệu chính xác hơn.
                $query = "select * from users where username like '%$search%'";
 
                // Kết nối sql
                mysql_connect("localhost", "root", "");
 
                // Thực thi câu truy vấn
                $sql = mysql_query($query);
 
                // Đếm số dòng để trả về
                $num = mysql_num_rows($sql);
 
                // Nếu có kết quả thì hiển thị, ngược lại thì thông báo không tìm thấy kết quả
                if ($num > 0 && $search != "") 
                {
                    // Dùng $num để đếm số dòng trả về.
                    echo "$num kết quả trả về với từ khóa <b>$search</b>";
 
                    // Vòng lặp while & mysql_fetch_assoc dùng để lấy toàn bộ dữ liệu có trong table và trả về dữ liệu ở dạng array.
                    echo '<table border="1" cellspacing="0" cellpadding="10">';
                    while ($row = mysql_fetch_assoc($sql)) {
                        echo '<tr>';
                            echo "<td>{$row['user_id']}</td>";
                            echo "<td>{$row['username']}</td>";
                            echo "<td>{$row['password']}</td>";// trả về kểt quả nếu tìm thấy
                            echo "<td>{$row['email']}</td>";
                            echo "<td>{$row['address']}</td>";
                        echo '</tr>';
                    }
                    echo '</table>';
                } 
                else {
                    echo "không tìm thấy kết quả!";
                }
            }
        }
        ?>   
    </body>
</html>
```

nhập thử và search 
<img src="http://image.prntscr.com/image/6821b873918c4d6eaec7c26f91a76712.png">


<a name="3"></a>
###Chức năng download/upload file

<img src="http://image.prntscr.com/image/fb3ea00ad6014f4d8aafe3ab2190d57b.png">

- ** giao diện tìm kiếm như thế này**
<img src="http://image.prntscr.com/image/8702033562234dd1afa92bfe561ba5c3.png">

- ** thử upload 1 file**
<img src="http://image.prntscr.com/image/e98a085a1a0e42abad066512d76fa2d4.png">

- giờ check folder khai báo trong code để lưu ` move_uploaded_file($file_tmp,"basic".$file_name);`

<img src="http://image.prntscr.com/image/e1be34322d6b4ea0befce2265ba96efa.png">

done!








